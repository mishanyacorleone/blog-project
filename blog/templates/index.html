<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Платформа для технических блогов</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Технический Блог</h1>
            <div>
                <form id="lang-form" method="post" style="display: none;">
                    {% csrf_token %}
                    <input type="hidden" name="language" value="">
                </form>
            </div>
        </header>

        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="{{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}

        <div class="preferences-form">
            <h2>Настройки отображения</h2>
            <form method="post" action="{% url 'save-preferences' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label>Выберите категории для отображения:</label>
                    <div class="checkbox-group">
                        {% for category in categories %}
                            <label class="checkbox-item">
                                <input type="checkbox" name="categories" value="{{ category }}"
                                    {% if category in selected_categories %}checked{% endif %}>
                                {{ category }}
                            </label>
                        {% endfor %}
                    </div>
                </div>

                <button type="submit">Сохранить настройки</button>
            </form>
        </div>

        <h2>Посты ({{ posts_list|length }})</h2>
        <div class="posts">
            {% for post in posts_list %}
                <div class="post-card">
                    <h3 class="post-title">{{ post.title }}</h3>
                    <div class="post-meta">
                        <span class="post-category">{{ post.category }}</span>
                        <span class="post-date">{{ post.date }}</span>
                    </div>
                    <p class="post-content">{{ post.content }}</p>
                </div>
            {% empty %}
                <p>Нет постов, соответствующих выбранным категориям.</p>
            {% endfor %}
        </div>
    </div>

    <script>
        // Автоматическая отправка формы при смене языка в шапке
        document.querySelector('.language-selector').addEventListener('change', function() {
            const form = document.getElementById('lang-form');
            form.querySelector('input[name="language"]').value = this.value;
            form.submit();
        });
    </script>
</body>
</html>